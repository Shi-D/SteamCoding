let blackUrl4K = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeIAAAFqCAYAAADGClkWAAAOnklEQVR4Xu3VwQkAMAwDMXf/oVvoEvdRFjCIwJ1td44AAQIECBBIBI4QJ+5GCRAgQIDAFxBij0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEBBiP0CAAAECBEIBIQ7xTRMgQIAAASH2AwQIECBAIBQQ4hDfNAECBAgQEGI/QIAAAQIEQgEhDvFNEyBAgAABIfYDBAgQIEAgFBDiEN80AQIECBAQYj9AgAABAgRCASEO8U0TIECAAAEh9gMECBAgQCAUEOIQ3zQBAgQIEHi8AmoQws1XRQAAAABJRU5ErkJggg==';
let blackUrl2K = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPIAAAC2CAYAAADjodDeAAAEb0lEQVR4Xu3TAQ0AIAwDwc2/aEhwwedQQK/rzswZjwCBrwXWkL/uz+cJPAFDdggEAgKGHChRBAKG7AYIBAQMOVCiCAQM2Q0QCAgYcqBEEQgYshsgEBAw5ECJIhAwZDdAICBgyIESRSBgyG6AQEDAkAMlikDAkN0AgYCAIQdKFIGAIbsBAgEBQw6UKAIBQ3YDBAIChhwoUQQChuwGCAQEDDlQoggEDNkNEAgIGHKgRBEIGLIbIBAQMORAiSIQMGQ3QCAgYMiBEkUgYMhugEBAwJADJYpAwJDdAIGAgCEHShSBgCG7AQIBAUMOlCgCAUN2AwQCAoYcKFEEAobsBggEBAw5UKIIBAzZDRAICBhyoEQRCBiyGyAQEDDkQIkiEDBkN0AgIGDIgRJFIGDIboBAQMCQAyWKQMCQ3QCBgIAhB0oUgYAhuwECAQFDDpQoAgFDdgMEAgKGHChRBAKG7AYIBAQMOVCiCAQM2Q0QCAgYcqBEEQgYshsgEBAw5ECJIhAwZDdAICBgyIESRSBgyG6AQEDAkAMlikDAkN0AgYCAIQdKFIGAIbsBAgEBQw6UKAIBQ3YDBAIChhwoUQQChuwGCAQEDDlQoggEDNkNEAgIGHKgRBEIGLIbIBAQMORAiSIQMGQ3QCAgYMiBEkUgYMhugEBAwJADJYpAwJDdAIGAgCEHShSBgCG7AQIBAUMOlCgCAUN2AwQCAoYcKFEEAobsBggEBAw5UKIIBAzZDRAICBhyoEQRCBiyGyAQEDDkQIkiEDBkN0AgIGDIgRJFIGDIboBAQMCQAyWKQMCQ3QCBgIAhB0oUgYAhuwECAQFDDpQoAgFDdgMEAgKGHChRBAKG7AYIBAQMOVCiCAQM2Q0QCAgYcqBEEQgYshsgEBAw5ECJIhAwZDdAICBgyIESRSBgyG6AQEDAkAMlikDAkN0AgYCAIQdKFIGAIbsBAgEBQw6UKAIBQ3YDBAIChhwoUQQChuwGCAQEDDlQoggEDNkNEAgIGHKgRBEIGLIbIBAQMORAiSIQMGQ3QCAgYMiBEkUgYMhugEBAwJADJYpAwJDdAIGAgCEHShSBgCG7AQIBAUMOlCgCAUN2AwQCAoYcKFEEAobsBggEBAw5UKIIBAzZDRAICBhyoEQRCBiyGyAQEDDkQIkiEDBkN0AgIGDIgRJFIGDIboBAQMCQAyWKQMCQ3QCBgIAhB0oUgYAhuwECAQFDDpQoAgFDdgMEAgKGHChRBAKG7AYIBAQMOVCiCAQM2Q0QCAgYcqBEEQgYshsgEBAw5ECJIhAwZDdAICBgyIESRSBgyG6AQEDAkAMlikDAkN0AgYCAIQdKFIGAIbsBAgEBQw6UKAIBQ3YDBAIChhwoUQQChuwGCAQEDDlQoggEDNkNEAgIGHKgRBEIGLIbIBAQMORAiSIQMGQ3QCAgYMiBEkUgYMhugEBAwJADJYpAwJDdAIGAgCEHShSBgCG7AQIBAUMOlCgCAUN2AwQCAoYcKFEEAobsBggEBAw5UKIIBC5+9rYBdXEiQgAAAABJRU5ErkJggg=='
let getUrl;
let t;
var fileObj; //获取文件对象
let postSrc=_URL+"work/";// 接收上传文件的后台地址

function clickGreenFlag(){
    document.getElementsByClassName("green-flag_green-flag_mk1Vo")[0].click();
}

function getCanvasThumb(content){
    fileObj = content;
    clickGreenFlag();
    window.localStorage.removeItem('strDataURI');
    t = window.setInterval(tryToGetThumb, 100);
}

function tryToGetThumb() {
    let canvas = document.getElementsByClassName("stage_stage_DTWo5")[0].getElementsByTagName("canvas")[0];
    getUrl = canvas.getContext("experimental-webgl", {preserveDrawingBuffer: true}).canvas.toDataURL();
    if(getUrl !== blackUrl2K && getUrl !== blackUrl4K){
        window.clearInterval(t);
        window.localStorage.setItem('strDataURI', getUrl);
        console.log(getUrl);
        let form = new FormData();
        form.append('uploadFile', fileObj); // 文件对象
        if(typeof(window.projectUrl)==='undefined'){
            form.append('uploadFileUrl',null);
        }
        else{
            form.append('uploadFileUrl',window.projectUrl);
        }
        form.append('uploadFileCover',window.localStorage.getItem('strDataURI'));
        let xhr = new XMLHttpRequest(); // XMLHttpRequest 对象
        xhr.open('post', postSrc+"uploadSB3File.action", true); //post方式，url为服务器请求地址，true 该参数规定请求是否异步处理。
        xhr.send(form); //开始上传，发送form数据
        xhr.onreadystatechange = function(){
            //若响应完成且请求成功
            if(xhr.readyState === 4 && xhr.status === 200){
                var data=xhr.responseText;
                data=eval('('+data+')');
                console.log(data);
                if(data[0].result === true){
                	alert("保存成功！");
                    console.log(_URL + data[0].message+'.sb3');
                    window.projectUrl =_URL + data[0].message+'.sb3';
                }else{
                	alert("保存失败！");
                }
            }
        }
    }
}


